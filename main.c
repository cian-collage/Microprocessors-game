#include <stm32f031x6.h>
#include "display.h"
#include <stdlib.h>
#include "sound.h"
#include "musical_notes.h"

#define Width 22 //image width
#define hight 19 //image hight

int Score_screen(int, int, int);
void Death_sound(void); //functions to paly death sound
void Win_sound(void); //functions to paly death sound
void initClock(void);
void initSysTick(void);
void SysTick_Handler(void);
void delay(volatile uint32_t dly);
void setupIO();
int isInside(uint16_t x1, uint16_t y1, uint16_t w, uint16_t h, uint16_t px, uint16_t py);
void enablePullUp(GPIO_TypeDef *Port, uint32_t BitNumber);
void pinMode(GPIO_TypeDef *Port, uint32_t BitNumber, uint32_t Mode);
void serial_log(char[]) ;

volatile uint32_t milliseconds;
volatile uint32_t milliseconds_score;

int Play = 1;


const uint16_t cat_stand[]= //standing cat
{
264,0,0,0,0,0,0,0,0,0,0,0,30918,30918,0,0,0,30918,30918,0,0,0,0,30918,30918,0,0,0,0,0,0,0,0,30918,30918,56705,30918,0,30918,30918,56705,30918,0,0,0,30918,30918,30918,0,0,0,0,0,0,30918,65535,65535,57293,65535,65535,65535,65535,57293,65535,0,0,0,0,30918,30918,0,0,0,0,0,0,30918,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,30918,30918,0,0,0,0,0,30918,65535,65535,65535,65535,30918,30918,30918,30918,65535,65535,65535,0,0,0,30918,30918,0,0,0,0,0,30918,65535,65535,30918,0,30918,30918,30918,30918,0,30918,65535,0,0,0,30918,30918,0,0,0,0,0,61307,61307,65535,30918,0,30918,30918,30918,30918,0,30918,65535,61307,0,0,30918,30918,0,0,0,0,0,30918,65535,65535,65535,65535,65535,65535,56705,65535,65535,65535,65535,0,0,0,65535,65535,30918,30918,30918,30918,0,61307,61307,65535,65535,65535,65535,30918,65535,30918,65535,65535,65535,61307,0,0,65535,65535,65535,65535,65535,65535,30918,30918,4368,4368,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,30918,30918,4368,40224,40224,40224,40224,40224,4368,0,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,30918,1994,65535,65535,0,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,0,0,0,65535,65535,65535,30918,30918,30918,30918,0,65535,65535,65535,0,30918,30918,30918,0,0,0,0,0,0,0,65535,65535,65535,0,30918,30918,30918,0,65535,65535,65535,0,30918,30918,30918,0,0,0,0,
};
const uint16_t cat_move[]=  //moveing cat
{
0,0,0,0,0,0,0,0,0,0,0,0,30918,30918,0,0,0,30918,30918,0,0,0,0,30918,30918,0,0,0,0,0,0,0,0,30918,30918,56705,30918,0,30918,30918,56705,30918,0,0,0,30918,30918,30918,0,0,0,0,0,0,30918,65535,65535,57293,65535,65535,65535,65535,57293,65535,0,0,0,0,30918,30918,0,0,0,0,0,0,30918,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,30918,30918,0,0,0,0,0,30918,65535,65535,65535,65535,30918,30918,30918,30918,65535,65535,65535,0,0,0,30918,30918,0,0,0,0,0,30918,65535,65535,30918,0,30918,30918,30918,30918,0,30918,65535,0,0,0,30918,30918,0,0,0,0,0,61307,61307,65535,30918,0,30918,30918,30918,30918,0,30918,65535,61307,0,0,30918,30918,0,0,0,0,0,30918,65535,65535,65535,65535,65535,65535,56705,65535,65535,65535,65535,0,0,0,65535,65535,30918,30918,30918,30918,0,61307,61307,65535,65535,65535,65535,30918,65535,30918,65535,65535,65535,61307,0,0,65535,65535,65535,65535,65535,65535,30918,30918,4368,4368,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,30918,30918,4368,40224,40224,40224,40224,40224,4368,0,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,30918,1994,65535,65535,0,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,30918,30918,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,30918,30918,30918,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,30918,30918,30918,30918,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,30918,30918,30918,30918,30918,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,30918,30918,30918,0,0,0,65535,65535,65535,0,65535,65535,65535,0,0,0,0,30918,30918,30918,30918,0,30918,30918,30918,0,0,0,0,65535,65535,0,65535,65535,65535,0,0,0,0,0,30918,30918,30918,0,
};

const uint16_t cat_safe[]=  //cat under Umbrella
{
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535,65535,30918,30918,30918,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535,40224,40224,40224,65535,65535,65535,40224,40224,40224,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535,40224,40224,40224,40224,40224,40224,65535,40224,40224,40224,40224,40224,40224,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,65535,65535,0,0,0,0,0,0,0,0,0,0,65535,40224,40224,40224,65535,65535,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,65535,65535,40224,40224,40224,40224,65535,0,0,0,0,0,0,0,0,65535,40224,40224,40224,65535,40224,40224,40224,40224,40224,65535,40224,40224,40224,65535,40224,40224,40224,40224,65535,40224,40224,40224,40224,65535,0,0,0,0,0,0,65535,40224,40224,40224,40224,40224,40224,40224,40224,40224,65535,40224,40224,40224,40224,40224,65535,40224,40224,40224,40224,40224,40224,40224,40224,40224,65535,0,0,0,0,0,65535,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,65535,0,0,0,0,65535,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,65535,0,0,0,65535,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,65535,0,0,65535,40224,65535,65535,40224,40224,40224,40224,40224,65535,40224,40224,40224,40224,40224,65535,40224,40224,40224,40224,40224,65535,40224,40224,40224,40224,40224,65535,65535,40224,65535,0,65535,65535,0,0,65535,40224,40224,40224,65535,0,65535,40224,40224,40224,65535,65535,65535,40224,40224,40224,65535,0,65535,40224,40224,40224,65535,0,0,65535,65535,0,30918,0,0,0,0,65535,65535,65535,0,0,0,65535,65535,65535,0,4368,0,65535,65535,65535,0,0,0,65535,65535,65535,0,0,0,0,30918,0,0,0,0,0,0,0,30918,0,0,0,0,0,30918,0,0,22355,0,0,30918,0,0,0,0,0,30918,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,22355,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,22355,30918,30918,0,0,0,30918,30918,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,30918,30918,56705,30918,0,30918,30918,56705,30918,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,30918,65535,65535,57293,65535,65535,65535,65535,57293,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,30918,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,30918,65535,65535,65535,65535,30918,30918,30918,30918,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,30918,65535,65535,30918,0,30918,30918,30918,30918,0,30918,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,61307,61307,65535,30918,0,30918,30918,30918,30918,0,30918,65535,61307,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,30918,65535,65535,65535,65535,65535,65535,56705,65535,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,61307,61307,65535,65535,65535,65535,30918,65535,30918,65535,65535,65535,61307,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,30918,30918,4368,4368,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,30918,65535,65535,30918,30918,4368,40224,40224,40224,40224,40224,4368,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,30918,30918,65535,65535,65535,65535,65535,65535,65535,30918,1994,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,30918,30918,65535,65535,65535,65535,0,65535,65535,65535,0,30918,30918,30918,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,30918,30918,30918,65535,65535,65535,0,65535,65535,65535,0,30918,30918,30918,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,30918,30918,30918,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,30918,30918,30918,30918,30918,30918,30918,30918,30918,30918,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
};
const uint16_t cloud_1[]= //cloud
{
37524,37524,37524,37524,37524,37524,37524,37524,29861,5020,21669,29861,29861,29861,29861,29861,29861,29861,29861,21669,21404,21669,29861,29861,29861,29861,29861,29861,29861,37524,37524,37524,37524,37524,37524,45716,37524,29861,29861,29861,29861,29861,29861,29861,29861,21669,29861,29861,29861,29861,29861,29861,13212,37524,5020,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,21669,29861,29861,29861,29861,21669,62364,29861,21669,29861,29861,29861,29861,37524,37524,45716,45716,37524,37524,37524,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,21669,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,5020,37524,37524,37524,37524,37524,61307,61307,61307,61307,37524,37524,37524,37524,37524,37524,37524,37524,29861,21669,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,37524,37524,29861,37524,37524,37524,37524,37524,37524,29861,21404,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,21669,29861,37524,37524,37524,37524,37524,37524,45716,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,37524,29861,29861,21669,29861,29861,29861,29861,37524,37524,37524,37524,37524,45716,61572,61307,61307,37524,37524,37524,37524,37524,37524,37524,37524,37524,21669,29861,29861,29861,29861,29861,45980,29861,21669,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,37524,37524,37524,37524,37524,37524,37524,37524,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,21669,29861,29861,29861,21669,29861,29861,29861,29861,29861,29861,29861,37524,37524,37524,37524,37524,37524,37524,37524,29861,21404,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,37524,37524,37524,37524,37524,37524,37524,61307,61307,37524,37524,37524,37524,37524,37524,45716,37524,37524,37524,37524,29861,29861,29861,29861,29861,37524,37524,29861,29861,29861,29861,5285,29861,29861,29861,37524,37524,37524,37524,37524,37524,37524,37524,45716,45716,37524,37524,37524,37524,29861,21669,29861,29861,29861,29861,29861,29861,37524,21404,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,21669,29861,29861,29861,29861,29861,29861,29861,29861,29861,21404,29861,29861,21669,29861,29861,29861,29861,29861,29861,37524,37524,37524,37524,37524,37524,37524,37524,37524,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,37524,37524,37524,37524,37524,37524,37524,37524,37524,61307,21140,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,29332,37524,37524,37524,29332,37524,37524,29861,29861,29861,29861,29861,37524,37524,37524,37524,37524,37524,37524,37524,45716,37524,37524,37524,37524,37524,45716,37524,45716,29861,29861,29861,29861,29861,37524,37524,37524,37524,37524,29861,37524,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,29861,37524,21404,29861,29861,29861,29861,29861,29861,29861,37524,29861,29861,29861,29861,37524,37524,29861,29861,29861,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,21669,29861,29861,29861,29861,45980,29861,21669,29861,29861,29861,29861,29861,29861,29861,45980,37524,37524,37524,37524,37524,37524,37524,37524,37524,37260,37524,61307,29332,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,45716,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,45716,45716,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,29332,37524,37524,37524,37524,37524,37524,37524,29861,21669,29861,29861,29861,29861,29861,29861,29861,29861,29861,37524,37524,37524,45716,45716,29861,37524,21404,29861,29861,29861,29861,29861,37524,37524,29332,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,45716,37524,37524,45716,37524,37524,37524,29861,29861,29861,29861,29861,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,61307,37524,61307,29332,37524,37524,37524,37524,37524,37524,37524,37260,37524,29332,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,45716,37524,37524,37524,37524,37524,45452,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,21404,29861,29861,29861,29861,29861,45980,37524,37524,37524,37524,37524,37524,37524,37524,29861,29861,29861,29861,29861,29861,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,45716,37524,37524,37524,37524,37524,37524,37524,37524,45716,37524,37524,45716,37524,37524,37524,37524,37524,37524,37524,21140,29332,37524,37524,37524,37524,37524,37524,37524,37524,37524,29332,37524,37524,37524,37524,37524,37260,37524,61307,61307,37524,37524,37524,37524,37524,37524,37524,37260,37524,37524,4492,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,29332,37524,37524,37524,37524,37524,37524,29332,37524,37524,37524,37524,37524,37524,61307,29332,37524,37524,37524,37524,37524,37524,37524,29068,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,45716,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,61307,61307,61307,61307,61307,37524,61307,61307,61307,45452,20876,37524,37524,37524,37260,37524,37524,61307,61307,37524,4492,37524,37524,37524,37524,37524,37524,29332,37524,37524,29332,37524,45188,61836,29332,37524,37524,37524,37524,37524,37524,37524,37524,61307,61307,53115,61307,61307,61307,61307,37524,37524,61307,4492,37524,37524,37260,37524,37524,37524,37524,37524,37524,37524,37524,37524,45716,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,45716,37524,37524,37524,37524,37260,37524,45452,37524,37524,37524,37524,37524,37524,37524,37524,37524,29332,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,61307,61307,61307,61307,20876,61307,4492,45188,37524,37524,61307,61307,61307,61307,61307,37524,37524,61307,29332,37524,37524,37524,29332,37524,37524,37524,37524,37524,37524,29332,37524,37524,37524,37524,37524,37524,37524,61307,61307,61307,61307,36731,61307,61307,61307,61307,61307,37524,37524,37524,37524,37524,44923,61307,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,29332,37524,37524,37524,37524,37524,37524,37524,37524,4492,37524,37524,37524,37524,37524,37524,37524,37524,37260,37524,61307,37524,37524,61307,61307,61307,37524,37524,37524,37524,37524,37524,37524,37524,4492,37524,37524,29332,37524,37524,37260,29332,37524,37524,37524,37524,37524,37524,37524,37524,61307,61307,61307,61307,61307,61307,61307,61307,61307,20083,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,37524,29332,37524,37524,61307,37524,4492,37524,37524,37524,37524,45716,37524,37524,37524,37260,37524,37524,37524,61307,61307,61307,61043,61307,61307,20083,60779,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,10834,60779,4492,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,61307,61307,61307,61307,53115,61307,61307,37524,37524,61307,4228,45452,37524,37524,37524,37260,37524,37524,44923,61307,61307,61307,37524,37524,37524,37524,37524,37524,37524,37524,37524,61572,37524,61307,61307,61307,61307,37524,37524,37524,37524,37524,45452,37524,37524,37524,37524,37524,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,37524,37524,45452,37524,37524,37524,37524,37524,37524,37524,37524,61307,61307,61043,61307,0,61307,61307,0,61043,60515,61043,61307,61043,61307,61307,61307,61307,61307,61307,61307,61043,61307,61307,61307,61307,61307,61307,37524,29332,37524,37524,37524,37524,37524,37524,37524,37524,37524,37524,12684,61307,61307,3963,61307,61043,61307,61307,61307,61307,37524,37524,37524,37524,37524,37524,37524,61307,61307,61307,28275,61307,61307,61307,61307,61307,29332,37524,37524,37524,37524,37524,29332,37524,61307,61307,61307,61307,61307,61307,61307,61307,37524,37524,61307,61307,61307,37524,37524,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,36203,28275,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,60515,61307,20347,61307,37524,37524,37524,37524,37524,37524,61307,61307,61307,61307,61043,61307,0,0,0,0,61307,61307,61043,61307,61307,61307,61043,60779,61307,61307,0,0,61307,0,61043,61307,61307,61307,61307,61307,61307,4492,37524,37524,37524,37524,37524,37524,37524,37524,37524,29068,61307,61307,61043,61307,0,61307,61307,61307,61043,61307,61307,61307,61307,44923,61307,61307,61307,0,0,61307,33560,61307,61307,61307,61307,61307,61307,37524,61307,4492,37524,37524,37524,61307,61307,61307,9777,61307,60779,61307,61307,61307,61307,61307,37524,37524,37524,61307,61307,61307,61307,61307,61307,28539,2114,61307,61307,2114,1849,61307,61307,60250,61307,0,61307,61307,61307,61307,28539,2114,2114,2114,61307,61307,33032,0,61307,61307,61307,61307,61307,44923,61307,61307,61307,61307,61307,61307,61307,44923,61307,0,0,0,0,0,0,0,61307,61307,61307,61307,61307,61307,0,0,0,0,0,61307,61307,12155,53115,61307,61307,61307,61307,61307,61307,61307,37524,37524,37524,37524,37524,61307,61307,61307,61307,61043,61307,61307,0,0,0,0,61307,61307,61307,61307,61307,61307,0,0,0,0,0,0,61307,3963,61307,44923,61307,61307,61307,61307,37524,37524,37524,37524,28539,59458,61307,33032,0,0,61307,61307,28539,61307,44923,61307,61307,61307,61307,61307,61307,61307,61307,61307,28539,61307,61307,0,0,61307,61307,60250,61043,61307,0,0,0,0,61307,61307,61307,61307,61307,61307,0,0,0,0,61307,61307,61043,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,61307,61307,44395,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,61043,61307,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,61307,61307,61307,28539,28539,28275,28539,28539,61307,28539,2114,61307,61307,0,0,0,0,0,0,61307,61307,61307,61307,61307,61307,61307,61307,61307,61307,28539,61307,61307,0,0,0,0,0,0,61307,61307,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,61307,61307,61307,61307,61307,61307,61307,61307,61043,61307,61307,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,61307,61307,61307,61307,61307,61307,61307,61307,60779,2114,2114,52851,61307,61307,61307,61307,0,0,16384,8192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,61307,61307,60515,61043,61307,61307,60515,61307,61307,0,0,0,0,0,0,0,0,0,0,0,61307,61307,61307,61307,61307,61307,61307,61307,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,61307,61307,61307,61307,61307,61307,61307,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,61307,61307,61307,61307,61307,61307,61307,61307,61307,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,61307,61307,61307,61307,61307,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
};

const uint16_t Rain_1[]= //Rain
{
0,0,0,0,0,10611,37598,8464,0,0,0,0,0,0,0,0,0,42305,62446,13294,27259,0,0,0,0,0,0,0,0,0,45526,13294,13294,13294,49152,0,0,0,0,0,0,0,42305,13294,13294,13294,13294,27259,0,0,0,0,0,0,0,53718,13294,13294,13294,13294,13294,13294,0,0,0,0,0,0,53982,13294,13294,21486,13294,13294,13294,10074,0,0,0,0,42305,13294,5102,13294,13294,13294,13294,13294,21222,0,0,0,0,45526,13294,13294,5102,13294,13294,13294,13294,13294,0,0,0,0,13294,13294,13294,13294,13294,13294,13294,13294,13294,0,0,0,0,21222,13294,13294,13294,13294,13294,5102,13294,13294,0,0,0,0,51563,13294,21486,13294,13294,13294,13294,13294,11148,0,0,0,0,0,21222,13294,13294,13294,13294,13294,0,0,0,0,0,0,0,51563,13294,13294,13294,13294,11148,0,0,0,0,
};

const uint16_t umbrella_1[]= //umbrella
{
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535,65535,30918,30918,30918,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535,40224,40224,40224,65535,65535,65535,40224,40224,40224,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535,40224,40224,40224,40224,40224,40224,65535,40224,40224,40224,40224,40224,40224,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,65535,65535,0,0,0,0,0,0,0,0,0,0,65535,40224,40224,40224,65535,65535,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,65535,65535,40224,40224,40224,40224,65535,0,0,0,0,0,0,0,0,65535,40224,40224,40224,65535,40224,40224,40224,40224,40224,65535,40224,40224,40224,65535,40224,40224,40224,40224,65535,40224,40224,40224,40224,65535,0,0,0,0,0,0,65535,40224,40224,40224,40224,40224,40224,40224,40224,40224,65535,40224,40224,40224,40224,40224,65535,40224,40224,40224,40224,40224,40224,40224,40224,40224,65535,0,0,0,0,0,65535,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,65535,0,0,0,0,65535,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,65535,0,0,0,65535,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,40224,65535,0,0,65535,40224,65535,65535,40224,40224,40224,40224,40224,65535,40224,40224,40224,40224,40224,65535,40224,40224,40224,40224,40224,65535,40224,40224,40224,40224,40224,65535,65535,40224,65535,0,65535,65535,0,0,65535,40224,40224,40224,65535,0,65535,40224,40224,40224,65535,65535,65535,40224,40224,40224,65535,0,65535,40224,40224,40224,65535,0,0,65535,65535,0,30918,0,0,0,0,65535,65535,65535,0,0,0,65535,65535,65535,0,30918,0,65535,65535,65535,0,0,0,65535,65535,65535,0,0,0,0,30918,0,0,0,0,0,0,0,30918,0,0,0,0,0,30918,0,0,30918,0,0,30918,0,0,0,0,0,30918,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,30918,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,30918,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,0,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,0,0,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
};

const uint16_t Black[]= //void
{
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
};

const uint16_t Black_2[]= //void
{
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
};
const uint16_t Black_3[]= //void
{
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
};


int main()
{
	//cat location
	int cat_hinverted;
	int cat_vinverted;
	int toggle;
	int cat_hmoved;
	int cat_vmoved;
	uint16_t cat_x;
	uint16_t cat_y;
	uint16_t cat_oldx;
	uint16_t cat_oldy;

	// rain location
	int Rain_vmoved;
	uint16_t Rain_x;
	uint16_t Rain_y;
	uint16_t Rain_oldx;
	uint16_t Rain_oldy;	

	//umbella lication
	int Umbrella_vmoved;
	int Umbrella_location_x;
	int Umbrella_location_y;
	uint16_t Umbrella_x;
	uint16_t Umbrella_y;
	uint16_t Umbrella_oldx;
	uint16_t Umbrella_oldy;

	//Game modifiers
	int lv_mod;
	int Hit;
	int GameMode = 0;
	int m_played;
	int i;
	int seconds;

	//main sound
	#define Note_length 12
	int Notes[Note_length] ={ D5,G5,B5,G5,A5,D5,D5,G5,B5,G5,A5,D6 };

	initClock();
	initSysTick();
	setupIO();
	initSound();
			

	//start screen
	cat_x = 10;
	cat_y = 116;

	putImage(cat_x,cat_y,Width,hight,cat_stand,cat_hinverted,0); //put cat standing
	
	
	//move cat
	while(cat_x<50) //while cat is not in the center of the screen
	{
		cat_x = cat_x + 2;
		cat_hmoved = 1;
		cat_hinverted=0;	

		if ((cat_vmoved) || (cat_hmoved)) //if cat moved
		{
			fillRectangle(cat_oldx,cat_oldy,Width,Width,0); //wipe cat
			cat_oldx = cat_x;
			cat_oldy = cat_y;			

			if (cat_hmoved) // if cat moved horizontally
			{
				if (toggle == 1) //swap between each image
				{
					putImage(cat_x,cat_y,Width,hight,cat_stand,cat_hinverted,0); //place cat standing
					toggle = 0;
					playNote(C6); 

				} //end if
				else
				{
					putImage(cat_x,cat_y,Width,hight,cat_move,cat_hinverted,0); //place cat moveing
					toggle = 1;
					playNote(D6);

				} //end else

			} //end if

		}	 //end if	

		delay(50);


		

	}


	playNote(0); //turn off sound
	putImage(cat_x,cat_y,32,24,Black_2,0,0); //get rid of cat
	putImage(cat_x-3,100,32,37,cat_safe,0,0); //place cat under umbrella
	delay(200);

	//palce Title
	printTextX2("CAT", 47, 40, RGBToWord(0xff,0xff,0), 0);
	printTextX2("SPLASH", 30, 60, RGBToWord(0xff,0xff,0), 0);

	delay(4000);

	fillRectangle(1,1,128,145,0); //wipe screen

	while(1) // main Game loop
	{

		while (GameMode == 0)//menue
		{
			//cat
			cat_hinverted = 0;
			cat_vinverted = 0;
			toggle = 0;
			cat_hmoved = 0;
			cat_vmoved = 0;
			cat_x = 50;
			cat_y = 100;
			cat_oldx = cat_x;
			cat_oldy = cat_y;

			//Rain
			Rain_vmoved = 0;
			Rain_x = 50;
			Rain_y = 16;
			Rain_oldx = Rain_x;
			Rain_oldy = Rain_y;

			//umbrella
			Umbrella_vmoved = 0;
			Umbrella_x = 10;
			Umbrella_y = 16;
			Umbrella_oldx = Umbrella_x;
			Umbrella_oldy = Umbrella_y;

			//Game start
			Umbrella_location_x = rand()%90 + 1;
			Umbrella_location_y = rand()%100 + 20;
			lv_mod = 1;
			Hit = 0; // not hit
			GameMode = 0; //open menue
			m_played = 0; //music note not played
			seconds = 0;
			i = 0;


			putImage(0,0,128,16,cloud_1,0,0); //Place colud
			putImage(cat_x-3,100,32,37,cat_safe,0,0); //place cat under umbrella

			//place Menue text
			printTextX2("Select", 30, 30, RGBToWord(0xff,0xff,0), 0);
			printTextX2("Mode:", 30, 50, RGBToWord(0xff,0xff,0), 0);

			printText("Normal", 5, 85, RGBToWord(0xff,0xff,10000), 0);
			printText("<-", 5, 100, RGBToWord(0xff,0xff,10000), 0);

			printText("Time ", 90, 80, RGBToWord(0xff,0xff,500), 0);
			printText("Trial", 90, 90, RGBToWord(0xff,0xff,500), 0);
			printText("->", 110, 100, RGBToWord(0xff,0xff,500), 0);
			

			if ((GPIOB->IDR & (1 << 5))==0) // left pressed
			{
				GameMode = 1; //normal mode
				cat_y = 116;
				putImage(cat_x-4,100,32,37,Black_3,0,0); //replace umbrella in new location

				while(cat_x>5) //while cat is not in the center of the screen
				{
					cat_x = cat_x - 2;
					cat_hmoved = 1;
					cat_hinverted=1;	

					if ((cat_vmoved) || (cat_hmoved)) //if cat moved
					{
						fillRectangle(cat_oldx,cat_oldy,Width,Width,0); //wipe cat
						cat_oldx = cat_x;
						cat_oldy = cat_y;			

						if (cat_hmoved) // if cat moved horizontally
						{
							if (toggle == 1) //swap between each image
							{
								putImage(cat_x,cat_y,Width,hight,cat_stand,cat_hinverted,0); //place cat standing
								toggle = 0;
								playNote(C6); 

							} //end if
							else
							{
								putImage(cat_x,cat_y,Width,hight,cat_move,cat_hinverted,0); //place cat moveing
								toggle = 1;
								playNote(D6);

							} //end else

						} //end if

					}	 //end if	
									
					delay(50);
				} //end while
				playNote(0);
				cat_x =100;
				fillRectangle(1,16,128,129,0); //wipe screen

			}//end if
			if ((GPIOB->IDR & (1 << 4))==0) // right pressed
			{
				GameMode = 2; //time trial mode
				cat_y = 116;
				putImage(cat_x-4,100,32,37,Black_3,0,0); //replace umbrella in new location

				while(cat_x<100) //while cat is not in the center of the screen
				{
					cat_x = cat_x + 2;
					cat_hmoved = 1;
					cat_hinverted=0;	
					


					if ((cat_vmoved) || (cat_hmoved)) //if cat moved
					{
						fillRectangle(cat_oldx,cat_oldy,Width,Width,0); //wipe cat
						cat_oldx = cat_x;
						cat_oldy = cat_y;			

						if (cat_hmoved) // if cat moved horizontally
						{
							if (toggle == 1) //swap between each image
							{
								putImage(cat_x,cat_y,Width,hight,cat_stand,cat_hinverted,0); //place cat standing
								toggle = 0;
								playNote(C6); 

							} //end if
							else
							{
								putImage(cat_x,cat_y,Width,hight,cat_move,cat_hinverted,0); //place cat moveing
								toggle = 1;
								playNote(D6);

							} //end else

						} //end if

					}	 //end if	
									
					delay(50);
				} //end while
				playNote(0);
				cat_x =1;
				fillRectangle(1,16,128,129,0); //wipe screen
			}//end else if


		}//end while
		
		//Normal mode
		while(GameMode == 1)
		{
			putImage(0,0,128,16,cloud_1,0,0);//place cloud

			do
			{
				Umbrella_location_x = rand()%90 + 1; //set x point to a randome num bettween 1-91
				Umbrella_location_y = rand()%70 + 50; //set y point to a randome num bettween 50-120


				if (isInside(cat_x,cat_y,Width,hight,Umbrella_location_x+12,Umbrella_location_y+16) ) //redo Umbrella location if it starts overlaping the cat
				{
					Umbrella_location_x = rand()%90 + 1;
					Umbrella_location_y = rand()%70 + 50;
				} //end if

				putImage(0,0,128,16,cloud_1,0,0); //re place cloud		
				printNumberX2(lv_mod-1, 10, 1, RGBToWord(0xff,0xff,0), 37524); //show score board
				putImage(cat_x,cat_y,Width,hight,cat_stand,cat_hinverted,0); //place standing cat


				while(1)
				{
					cat_oldx = cat_x;
					cat_oldy = cat_y;			

					//sound
					if((milliseconds <= 375 )) // play note if 375 milliseconds have passed
					{
						if (m_played != 1) //if note has not been played
						{
							playNote(Notes[i]); //play note in array
							m_played = 1; //set to palyed

						} //end if

					} //end if

					if (milliseconds >= 375 )//after 375 milliseconds switch notes
					{
						i++;
						milliseconds = 0;
						m_played = 0;
						
					} //end if

					if(i == Note_length) //if end of notes is reached restart array
					{
						i=0;
					} //end if


					//cat
					cat_hmoved = cat_vmoved = 0;
					cat_hinverted  = 1;
					if ((GPIOB->IDR & (1 << 4))==0) // right pressed
					{					
						if (cat_x < 100)
						{
							cat_x = cat_x + (lv_mod+1); //move cat right
							cat_hmoved = 1; //mark as moved horizontally
							cat_hinverted=0; //mark as moveing right

						} //end if

					} //end if
					if ((GPIOB->IDR & (1 << 5))==0) // left pressed
					{			
						if (cat_x > 10)
						{
							cat_x = cat_x - (lv_mod+1); //move cat left
							cat_hmoved = 1; //mark as moved horizontally
							cat_hinverted=1; //mark as moveing left
					
						} //end if			
					
					} //end if
					if ( (GPIOA->IDR & (1 << 11)) == 0) // down pressed
					{
						if (cat_y < 140)
						{
							cat_y = cat_y + (lv_mod+1); //move cat down	
							cat_vmoved = 1; //mark as moved Verticaly
							cat_vinverted = 0; //mark as moved down
					
						} //end if
					
					} //end if
					if ( (GPIOA->IDR & (1 << 8)) == 0) // up pressed
					{			
						if (cat_y > 16)
						{
							cat_y = cat_y - (lv_mod+1); //move cat down	
							cat_vmoved = 1; //mark as moved Verticaly
							cat_vinverted = 1; //mark as moved up
					
						} //end if
					
					} //end if

					if ((cat_vmoved) || (cat_hmoved)) //if cat moved in any way
					{

						fillRectangle(cat_oldx,cat_oldy,Width,Width,0); //wipe cat image		

						if (cat_hmoved) //if cat moved horizontally play move animation
						{
							if (toggle == 1)
							{
								putImage(cat_x,cat_y,Width,hight,cat_stand,cat_hinverted,0); //place standing cat
								toggle = 0;
								
							} //end if
							else
							{
								putImage(cat_x,cat_y,Width,hight,cat_move,cat_hinverted,0);	//place movieng cat
								toggle = 1;

							} //end else

						} //end if
						else //if cat moved verticaly play move animation
						{
							if (toggle == 1)
							{
								putImage(cat_x,cat_y,Width,hight,cat_stand,cat_hinverted,0); //place standing cat
								toggle = 0;
								
							} //end if
							else
							{
								putImage(cat_x,cat_y,Width,hight,cat_move,cat_hinverted,0);	//place movieng cat
								toggle = 1;

							} //end else

						} //end else
						
					} //end if

					delay(50); 

					//Rain
					if( isInside(Rain_x,Rain_y,Width,hight,cat_x+5,cat_y+5) || isInside(Rain_x,Rain_y,Width,hight,cat_x+17,cat_y+5) || 
					isInside(Rain_x,Rain_y,Width,hight,cat_x+5,cat_y+14) || isInside(Rain_x,Rain_y,Width,hight,cat_x+17,cat_y+14) ) //Rain touches the cat
					{
						putImage(Rain_x,Rain_y,13,13,Black,0,0); //wipe rain
						Hit = 1; //mark as hit
						Death_sound(); //play death sound function		
						break; //end Gamemode loop

					} //end if

					if(Rain_y < 145) //if rain has not reached the bottem of the screen
					{
						putImage(Rain_x,Rain_y,13,13,Black,0,0); //wipe rain
						Rain_y = Rain_y + lv_mod; //move rain	
						Rain_vmoved = 1; //mark rain as moved
						putImage(Rain_x,Rain_y,13,13,Rain_1,0,0); //place rain in new position

						if (isInside(Rain_x,Rain_y,13,13,Umbrella_location_x,Umbrella_location_y) || isInside(Rain_x,Rain_y,13,13,Umbrella_location_x +24,Umbrella_location_y) ||
						 isInside(Rain_x,Rain_y,13,13,Umbrella_location_x,Umbrella_location_y+32) || isInside(Rain_x,Rain_y,13,13,Umbrella_location_x+12,Umbrella_location_y) ) //if rain hits umbrella
						{
							putImage(Rain_x,Rain_y,13,13,Black,0,0); //wipe rain
							Rain_y = 16; //move rain to the top of screen
							Rain_x =rand()%110 + 1; //randomise the rains x location

						} //end if

					} //end if			
					else //if rain reaches the bottem of the screen
					{
						putImage(Rain_x,Rain_y,13,13,Black,0,0); //wipe rain
						Rain_y = 16; //move rain to the top of screen
						Rain_x =rand()%70 + 1; //randomise the rains x location

					} //end else

					//Safe
					putImage(Umbrella_location_x,Umbrella_location_y,32,24,umbrella_1,0,0); //place umbrella

					if (isInside(cat_x,cat_y,Width,hight,Umbrella_location_x+12,Umbrella_location_y+16) ) //if cat touches the umbrella 
					{
						putImage(cat_x,cat_y,32,24,Black_2,0,0); //wipe cat
						putImage(Umbrella_location_x,Umbrella_location_y,32,37,cat_safe,0,0); //place Cat safe where the cat was
						putImage(Rain_x,Rain_y,13,13,Black,0,0); //wipe rain
						Rain_y = 16; //move rain to the top
						Rain_x =rand()%70 + 1; //randomise the rains x location
						playNote(0); //turn off sound
						Win_sound();
						delay(1000);
						putImage(Umbrella_location_x,Umbrella_location_y,32,37,Black_3,0,0); //replace umbrella in new location
						lv_mod = lv_mod + 1; //increse score/difficulty

						break; //rest game with new score/difficulty
						
					} //end if
					
				} //end while
				
			}while(Hit == 0);//loop if not hit yet

			GameMode = Score_screen(lv_mod, GameMode,milliseconds_score);

		}// if(GameMode == 1) end


		//Time Trial
		while (GameMode == 2)
		{
			milliseconds_score = 0; //reset time score
			putImage(0,0,128,16,cloud_1,0,0); //place colud

			do
			{
				putImage(0,0,128,16,cloud_1,0,0); //re-place coud
				putImage(cat_x,cat_y,Width,hight,cat_stand,cat_hinverted,0); //place standing cat


				while(1)
				{
					seconds = milliseconds_score/1000; 
					cat_oldx = cat_x;
					cat_oldy = cat_y;		
					printNumberX2(seconds, 10, 1, RGBToWord(0xff,0xff,0), 37524); //display current score / seconds passed

					if (seconds>5) // if 5 seconds have passed
					{
						lv_mod = seconds/5; //increse speed every 5 seconds

					}//end if
						

					//sound
					if(milliseconds <= 375 - (lv_mod*20) ) // play note if 375 milliseconds have passed
					{
						if (m_played != 1) //if note has not been played
						{
							playNote(Notes[i]); //play note in array
							m_played = 1; //set to palyed

						} //end if

					} //end if

					if (milliseconds >= 375 - (lv_mod*20) ) //after 375 milliseconds switch notes
					{
						i++;
						milliseconds = 0;
						m_played = 0;
						
					} //end if

					if(i == Note_length) //if end of notes is reached restart array
					{
						i=0;
					} //end if


					//cat
					cat_hmoved = cat_vmoved = 0;
					cat_hinverted  = 1;
					if ((GPIOB->IDR & (1 << 4))==0) // right pressed
					{					
						if (cat_x < 100)
						{
							cat_x = cat_x + (lv_mod+1); //move cat right
							cat_hmoved = 1; //mark as moved horizontally
							cat_hinverted=0; //mark as moveing right

						} //end if

					} //end if
					if ((GPIOB->IDR & (1 << 5))==0) // left pressed
					{			
						if (cat_x > 1)
						{
							cat_x = cat_x - (lv_mod+1); //move cat left
							cat_hmoved = 1; //mark as moved horizontally
							cat_hinverted=1; //mark as moveing left
					
						} //end if			
					
					} //end if
					if ( (GPIOA->IDR & (1 << 11)) == 0) // down pressed
					{
						if (cat_y < 140)
						{
							cat_y = cat_y + (lv_mod+1); //move cat down	
							cat_vmoved = 1; //mark as moved Verticaly
							cat_vinverted = 0; //mark as moved down
					
						} //end if
					
					} //end if
					if ( (GPIOA->IDR & (1 << 8)) == 0) // up pressed
					{			
						if (cat_y > 16)
						{
							cat_y = cat_y - (lv_mod+1); //move cat down	
							cat_vmoved = 1; //mark as moved Verticaly
							cat_vinverted = 1; //mark as moved up
					
						} //end if
					
					} //end if

					if ((cat_vmoved) || (cat_hmoved)) //if cat moved in any way
					{

						fillRectangle(cat_oldx,cat_oldy,Width,Width,0); //wipe cat image
						cat_oldx = cat_x;
						cat_oldy = cat_y;		

						if (cat_hmoved) //if cat moved horizontally play move animation
						{
							if (toggle == 1)
							{
								putImage(cat_x,cat_y,Width,hight,cat_stand,cat_hinverted,0); //place standing cat
								toggle = 0;
								
							} //end if
							else
							{
								putImage(cat_x,cat_y,Width,hight,cat_move,cat_hinverted,0);	//place movieng cat
								toggle = 1;

							} //end else

						} //end if
						else //if cat moved verticaly play move animation
						{
							if (toggle == 1)
							{
								putImage(cat_x,cat_y,Width,hight,cat_stand,cat_hinverted,0); //place standing cat
								toggle = 0;
								
							} //end if
							else
							{
								putImage(cat_x,cat_y,Width,hight,cat_move,cat_hinverted,0);	//place movieng cat
								toggle = 1;

							} //end else

						} //end else
						
					} //end if

					delay(50); 

					//Rain
					if (isInside(Rain_x,Rain_y,Width,hight,cat_x+5,cat_y+5) || isInside(Rain_x,Rain_y,Width,hight,cat_x+17,cat_y+5) || 
					isInside(Rain_x,Rain_y,Width,hight,cat_x+5,cat_y+14) || isInside(Rain_x,Rain_y,Width,hight,cat_x+17,cat_y+14) ) //if rain hits cat
						{
							putImage(Rain_x,Rain_y,13,13,Black,0,0); //wipe rain
							Hit = 1; //mark as hit
							Death_sound(); //play death sound function
							break; //end gamemode loop

						} //end if

					if(Rain_y < 145) //if rain has not reached the bottem of the screen
					{
						putImage(Rain_x,Rain_y,13,13,Black,0,0); //wipe rain
						Rain_y = Rain_y + lv_mod; //move rain	
						Rain_vmoved = 1; //mark rain as moved
						putImage(Rain_x,Rain_y,13,13,Rain_1,0,0); //place rain in new position

					}			
					else //if rain reaches the bottem of the screen
					{
						putImage(Rain_x,Rain_y,13,13,Black,0,0); //wipe rain
						Rain_y = 16; //move rain to the top of screen
						Rain_x =rand()%110 + 1; //randomise the rains x location

					} //end else
					
				}//end while
				
			}while(Hit == 0);

			GameMode = Score_screen(lv_mod, GameMode, seconds);

		}// if(GameMode == 2) end
		
		playNote(0); //stop sound

	}//infinit game loop end

}// end main
	
int Score_screen(lv_mod, GameMode, seconds)
{
	
	playNote(0); //turn off sound
	fillRectangle(1,1,128,145,0);//wipe display

	//display Game info
	printTextX2("You Got", 25, 30, RGBToWord(0xff,0xff,0), 0);
	printTextX2("Wet", 45, 50, RGBToWord(0xff,0xff,0), 0);
	printTextX2("Score", 10, 90, RGBToWord(0xff,0xff,10000), 0);
	
	if (GameMode == 1)//display score as LV-mod if in normal mode
	{
		printNumberX2(lv_mod -1 , 10, 120, RGBToWord(0xff,0xff,100), 0);
	}
	else if(GameMode == 2)//display score as seconds if in normal mode
	{
		printNumberX2(seconds, 10, 120, RGBToWord(0xff,0xff,100), 0);	
	}

	delay(5000);
	fillRectangle(1,1,128,145,0); //wipe display

	GameMode = 0; //reset back to menue
	return GameMode;
}
void Death_sound(void) //plays death sound notes
{
	playNote(0);
	delay(1);
	playNote(DS4_Eb4);
	delay(100);							
	playNote(D4);
	delay(100);
	playNote(CS4_Db4);
	delay(100);
	playNote(0);
							
}

void Win_sound(void) //plays death sound notes
{
	playNote(0);
	delay(1);
	playNote(C5);
	delay(100);							
	playNote(D5);
	delay(100);
	playNote(E5);
	delay(100);
	playNote(G5);
	delay(100);		
	playNote(0);
							
}
void initSysTick(void)
{
	SysTick->LOAD = 48000;
	SysTick->CTRL = 7;
	SysTick->VAL = 10;
	__asm(" cpsie i "); // enable interrupts
}

void SysTick_Handler(void) //counts milliseconds
{
	milliseconds++;
	milliseconds_score++;
}

void initClock(void)
{
// This is potentially a dangerous function as it could
// result in a system with an invalid clock signal - result: a stuck system
        // Set the PLL up
        // First ensure PLL is disabled
        RCC->CR &= ~(1u<<24);
        while( (RCC->CR & (1 <<25))); // wait for PLL ready to be cleared
        
// Warning here: if system clock is greater than 24MHz then wait-state(s) need to be
// inserted into Flash memory interface
				
        FLASH->ACR |= (1 << 0);
        FLASH->ACR &=~((1u << 2) | (1u<<1));
        // Turn on FLASH prefetch buffer
        FLASH->ACR |= (1 << 4);
        // set PLL multiplier to 12 (yielding 48MHz)
        RCC->CFGR &= ~((1u<<21) | (1u<<20) | (1u<<19) | (1u<<18));
        RCC->CFGR |= ((1<<21) | (1<<19) ); 

        // Need to limit ADC clock to below 14MHz so will change ADC prescaler to 4
        RCC->CFGR |= (1<<14);

        // and turn the PLL back on again
        RCC->CR |= (1<<24);        
        // set PLL as system clock source 
        RCC->CFGR |= (1<<1);
}
void delay(volatile uint32_t dly)
{
	uint32_t end_time = dly + milliseconds;
	while(milliseconds != end_time)
		__asm(" wfi "); // sleep
}

void enablePullUp(GPIO_TypeDef *Port, uint32_t BitNumber)
{
	Port->PUPDR = Port->PUPDR &~(3u << BitNumber*2); // clear pull-up resistor bits
	Port->PUPDR = Port->PUPDR | (1u << BitNumber*2); // set pull-up bit
}
void pinMode(GPIO_TypeDef *Port, uint32_t BitNumber, uint32_t Mode)
{
	uint32_t mode_value = Port->MODER;
	Mode = Mode << (2 * BitNumber);
	mode_value = mode_value & ~(3u << (BitNumber * 2));
	mode_value = mode_value | Mode;
	Port->MODER = mode_value;
}
int isInside(uint16_t x1, uint16_t y1, uint16_t w, uint16_t h, uint16_t px, uint16_t py)
{
	// checks to see if point px,py is within the rectange defined by x,y,w,h
	uint16_t x2,y2;
	x2 = x1+w;
	y2 = y1+h;
	int rvalue = 0;
	if ( (px >= x1) && (px <= x2))
	{
		// ok, x constraint met
		if ( (py >= y1) && (py <= y2))
			rvalue = 1;
	}
	return rvalue;
}

void setupIO()
{
	RCC->AHBENR |= (1 << 18) + (1 << 17); // enable Ports A and B
	display_begin();
	pinMode(GPIOB,4,0);
	pinMode(GPIOB,5,0);
	pinMode(GPIOA,8,0);
	pinMode(GPIOA,11,0);
	enablePullUp(GPIOB,4);
	enablePullUp(GPIOB,5);
	enablePullUp(GPIOA,11);
	enablePullUp(GPIOA,8);
}